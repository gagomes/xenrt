<?xml version="1.0" ?>
<xenrt>

  <!-- Verify Clearwater to Creedence upgrade license tests -->

  <default name="OLD_PRODUCT_VERSION" value="Clearwater"/>
  <default name="OLD_PRODUCT_INPUTDIR" value="/usr/groups/release/XenServer-6.x/XS-6.2/RTM-70446/"/>

  <variables>
    <PRODUCT_VERSION>Creedence</PRODUCT_VERSION>    
    <OLD_PRODUCT_INPUTDIR>/usr/groups/release/XenServer-6.x/XS-6.2/RTM-70446/</OLD_PRODUCT_INPUTDIR>
    <OLD_PRODUCT_VERSION>Clearwater</OLD_PRODUCT_VERSION>    
  </variables>

 <preprepare>
      <host id="0">
        <vm name="LicenseServer">
          <file>%LICENSE_SERVER_XVA%</file>
          <postinstall action="installV6LicenseServer"/>
        </vm>
        <vm name="oldLicenseServer">
          <file>%OLD_LICENSE_SERVER_XVA%</file>
          <postinstall action="installV6LicenseServer"/>
        </vm>
      </host>
 </preprepare>

  <prepare>     
        <pool id="0">
        <host id="1" productVersion="${OLD_PRODUCT_VERSION}" version="${OLD_PRODUCT_INPUTDIR}" license="no"> 
        </host>        
        <host id="2" productVersion="${OLD_PRODUCT_VERSION}" version="${OLD_PRODUCT_INPUTDIR}" license="no"/>
        <storage type="nfs" name="nfssr" default="true"/>
       </pool> 
  </prepare>

  <testsequence>
   <serial group="LicensedCWUpgrade">      
      <testcase id="xenserver.tc.mulskulicense.TCCWOldLicenseServerExp" name="License1" tc="TC-12345">
        <arg>expectededition=enterprise-per-socket</arg>
        <arg>oldlicenseserver=oldLicenseServer</arg>
        <arg>oldlicenseedition=per-socket</arg>
        <arg>newlicenseserver=LicenseServer</arg>
      </testcase>  
      <action action="prepare"/>
      <testcase id="xenserver.tc.mulskulicense.TCCWOldLicenseServerUpg" name="License2" tc="TC-12346">
        <arg>expectededition=enterprise-per-socket</arg>
        <arg>oldlicenseserver=oldLicenseServer</arg>
        <arg>oldlicenseedition=per-socket</arg>
        <arg>newlicenseserver=LicenseServer</arg>
      </testcase>
      <action action="prepare"/>
      <testcase id="xenserver.tc.mulskulicense.TCCWNewLicenseServer" name="License3" tc="TC-12347">
        <arg>expectededition=enterprise-per-socket</arg>
        <arg>oldlicenseserver=oldLicenseServer</arg>
        <arg>oldlicenseedition=per-socket</arg>
        <arg>newlicenseserver=LicenseServer</arg>
      </testcase> 
      <action action="prepare"/>
      <testcase id="xenserver.tc.mulskulicense.TCCWOldLicenseServerExp" name="License4" tc="TC-12348">
        <arg>expectededition=free</arg>
        <arg>oldlicenseserver=oldLicenseServer</arg>
        <arg>oldlicenseedition=xendesktop</arg>
        <arg>newlicenseserver=LicenseServer</arg>
        <arg>grace</arg>
      </testcase>
      <action action="prepare"/>
      <testcase id="xenserver.tc.mulskulicense.TCCWOldLicenseServerUpg" name="License5" tc="TC-12349">
        <arg>expectededition=xendesktop-platinum</arg>
        <arg>oldlicenseserver=oldLicenseServer</arg>
        <arg>oldlicenseedition=xendesktop</arg>
        <arg>newlicenseserver=LicenseServer</arg>
        <arg>grace</arg>
      </testcase>
      <action action="prepare"/>
      <testcase id="xenserver.tc.mulskulicense.TCCWNewLicenseServer" name="License6" tc="TC-12340">
        <arg>expectededition=free</arg>
        <arg>oldlicenseserver=oldLicenseServer</arg>
        <arg>oldlicenseedition=xendesktop</arg>
        <arg>newlicenseserver=LicenseServer</arg>
      </testcase>
      <action action="prepare"/>
      <testcase id="xenserver.tc.mulskulicense.TCCWNewLicenseServer" name="License7" tc="TC-12341">
        <arg>expectededition=enterprise-pre-socket</arg>
        <arg>oldlicenseserver=oldLicenseServer</arg>
        <arg>oldlicenseedition=per-socket</arg>
        <arg>newlicenseserver=LicenseServer</arg>
        <arg>addlicfiles</arg>
      </testcase>
   </serial>   
    
  </testsequence>
</xenrt>
